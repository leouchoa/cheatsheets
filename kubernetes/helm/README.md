# Helm

Can be thought of as a package manager for kubernetes, helping us deal with the
immense amount of yaml configs files for k8s setups. The many helm charts can be
found at [artifacthub.io](https://artifacthub.io).

By the way: you can install more then one chart per cluster.

## Quick Commands

- find charts: `helm search hub CHART_HERE`
- add a specific repo to `kubectl` node: `helm repo add NAME_HERE URL_HERE`. Example:
  - add the wordpress repo with `helm repo add bitnami https://charts.bitnami.com/bitnami`
  - search the wordpress chart inside this new remote repo: `helm search repo wordpress`
- list helm chart repositories: `helm repo list`
- uninstall a release: `helm uninstall release name`
- remove a repo: `helm repo remove REPO_NAME`
- upgrade a release: `helm upgrade RELEASE_NAME REPO/IMAGE --version NUMBER`. Example:
  - `helm upgrade dazzling-web bitnami/nginx --version 13`
- rollback a release: `helm rollback RELEASE_NAME REVISION_NUMBER`
- create a chart template in the current dir: `heml create your-chart-name`
- lint your helm chart with: `helm lint ./chart-dir`
- you can verify what would be generated by your chart by running a template on top
of it
  1. suppose you have a **already written** helm chart inside `./chart-dir` with
  templates and stuff
  2. if you run `helm template ./chart-dir` on top of it, it won't rewrite your code
  with the empty template, it will populate your code with the template values
  populated.
- you can see the yaml that helm generates with: `helm template ./chart-dir --debug`
- that are errors that will only happen inside k8s. To chatch them,
install them with the `--dry-run` flag: `helm install RELEASE_NAME ./chart-dir --dry-run`
- if you're repeating an entry a lot of times, consider using named templates.

## Quick Examples

### Deploy Apache Example

Deploy the `Apache` application on the cluster using the `apache` from the `bitnami`
repository and set the release `Name` to `amaze-surf`:

```bash
helm install amaze-surf bitname/apache
```

### Upgrading a Release

```bash
helm repo add bitnami https://charts.bitnami.com/bitnami
helm install amaze-surf bitname/nginx
helm upgrade dazzling-web bitnami/nginx --version 13
```

### About Templating

If using templating in your helm chart, you specify them by either:

1. using the flag `--set`: `--set= YourTemplateValue=the_value`
2. adding them to the `values.yaml` file.

Some built-in objects for using in templates are available [here](https://helm.sh/docs/chart_template_guide/builtin_objects/).

To better organize your code, use dictionaries. Example:

```yaml
# file: values.yaml

replicaCount: 2
image:
    repo: nginx
    tag: "1.16.0"
```

and access them with `{{ .Values.image.repo }}` or  `{{ .Values.image.tag }}`

## Notable Differences Between Helm 2 and Helm 3

- RBAC added, meaning no more `Tiller` in between Helm and the cluster in v3
- 3-way strategic merge path

## About `apiVersion` in Chart File

For working with helm v3 you gotta add `apiVersion: v2`. If you're creating
charts for helm v2, then ignore it because it can lead to unexpected results/bugs.
